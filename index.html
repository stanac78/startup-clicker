<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>üöÄ Fus√©e Clicker - Vers l‚ÄôEspace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Nunito', sans-serif;
      background: #00111f;
      color: #cfd8dc;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      user-select: none;
    }
    header {
      padding: 20px;
      text-align: center;
      background: #011627;
      width: 100%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
    }
    h1 {
      margin: 0;
      font-weight: 700;
      color: #a1caff;
    }
    main {
      width: 90%;
      max-width: 480px;
      margin-top: 20px;
      background: #022c43;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.9);
    }
    .stats, .items, .launch, .powerups {
      margin-top: 15px;
    }
    .stats p, .progress-text {
      font-size: 1.1em;
      margin: 5px 0;
    }
    button {
      font-size: 1em;
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background: #0f4c75;
      color: #a1caff;
      box-shadow: 0 2px 6px #0f4c75;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background: #3282b8;
      box-shadow: 0 3px 10px #3282b8;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
      box-shadow: none;
      color: #999;
    }
    .item-card {
      display: flex;
      justify-content: space-between;
      background: #144d6e;
      border-radius: 12px;
      padding: 12px 15px;
      margin: 10px 0;
      align-items: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.5);
    }
    .item-info {
      flex: 1;
    }
    .item-info span {
      display: block;
      font-weight: 600;
      font-size: 1.05em;
    }
    .item-stats {
      font-size: 0.9em;
      color: #a1caff;
      margin-top: 3px;
    }
    .item-controls {
      text-align: right;
    }
    .upgrade-btn {
      margin-left: 10px;
      background: #ffb703;
      color: #000;
      font-weight: 700;
      box-shadow: 0 2px 8px #ffb703;
    }
    .powerup-btn {
      background: #e76f51;
      font-weight: 700;
      box-shadow: 0 2px 8px #e76f51;
    }
    .progress-bar-container {
      background: #12344a;
      border-radius: 10px;
      height: 20px;
      margin-top: 10px;
      overflow: hidden;
      box-shadow: inset 0 2px 6px rgba(255,255,255,0.1);
    }
    .progress-bar {
      background: #ffb703;
      height: 100%;
      width: 0%;
      transition: width 0.3s ease;
    }
    footer {
      margin-top: 40px;
      padding: 10px;
      font-size: 0.8em;
      color: #555;
      user-select: none;
    }
  </style>
</head>
<body>

<header>
  <h1>üöÄ Fus√©e Clicker - Vers l‚ÄôEspace</h1>
</header>

<main>

  <section class="stats">
    <p><strong>Distance Max Atteinte :</strong> <span id="distanceMax">0</span> km</p>
    <p><strong>Distance Restante :</strong> <span id="distanceLeft">1000000</span> km</p>
    <p><strong>Argent :</strong> <span id="money">0</span> ‚Ç¨</p>
    <p><strong>Distance par clic :</strong> <span id="distPerClick">1</span> km</p>
    <p><strong>Distance par seconde :</strong> <span id="distPerSec">0</span> km</p>
  </section>

  <section class="items">
    <h2>üõ†Ô∏è Construis ta fus√©e</h2>
    <div id="itemsContainer">
      <!-- Items ajout√©s dynamiquement -->
    </div>
  </section>

  <section class="powerups">
    <h2>‚ö° Power-ups</h2>
    <button id="doubleClick" class="powerup-btn" disabled>Double distance clic (30s) - Co√ªt: 500 ‚Ç¨</button>
    <button id="doubleAuto" class="powerup-btn" disabled>Double distance auto (30s) - Co√ªt: 800 ‚Ç¨</button>
    <p id="powerupStatus" style="margin-top:10px; font-style: italic;"></p>
  </section>

  <section class="launch">
    <h2>üöÄ Lancement de la fus√©e</h2>
    <button id="launchBtn" disabled>Lancer la fus√©e (Co√ªt : 1000 ‚Ç¨)</button>
    <div class="progress-bar-container" aria-label="Progression du lancement">
      <div class="progress-bar" id="launchProgress"></div>
    </div>
    <p class="progress-text" id="launchText"></p>
  </section>

</main>

<footer>
  Construis ta fus√©e, am√©liore tes √©quipements et atteins 1 000 000 km pour conqu√©rir l‚Äôespace !
</footer>

<script>
  // Constants
  const TARGET_DISTANCE = 1_000_000; // 1 million km pour l‚Äôespace
  const LAUNCH_COST = 1000;
  const POWERUP_DURATION = 30 * 1000; // 30 secondes en ms

  // Game state variables
  let money = parseFloat(localStorage.getItem("money")) || 0;
  let distPerClick = parseFloat(localStorage.getItem("distPerClick")) || 1;
  let distPerSec = parseFloat(localStorage.getItem("distPerSec")) || 0;
  let distanceMax = parseFloat(localStorage.getItem("distanceMax")) || 0;

  // Items d√©finis avec base cost, distance boost per unit, et upgrade multiplier
  let items = {
    engine: { 
      name: "Moteur basique", 
      baseCost: 200, 
      quantity: 0, 
      distBoost: 10, 
      upgradeLevel: 0, 
      upgradeCost: 150, 
      cost: 200,
      visible: false
    },
    fuelTank: { 
      name: "R√©servoir de carburant", 
      baseCost: 500, 
      quantity: 0, 
      distBoost: 25, 
      upgradeLevel: 0, 
      upgradeCost: 400, 
      cost: 500,
      visible: false
    },
    cockpit: { 
      name: "Cockpit am√©lior√©", 
      baseCost: 1200, 
      quantity: 0, 
      distBoost: 60, 
      upgradeLevel: 0, 
      upgradeCost: 1000, 
      cost: 1200,
      visible: false
    },
    navigation: { 
      name: "Syst√®me de navigation", 
      baseCost: 3000, 
      quantity: 0, 
      distBoost: 150, 
      upgradeLevel: 0, 
      upgradeCost: 2500, 
      cost: 3000,
      visible: false
    },
    heatShield: { 
      name: "Bouclier thermique", 
      baseCost: 7500, 
      quantity: 0, 
      distBoost: 400, 
      upgradeLevel: 0, 
      upgradeCost: 6000, 
      cost: 7500,
      visible: false
    },
    satellite: { 
      name: "Satellite", 
      baseCost: 15000, 
      quantity: 0, 
      distBoost: 900, 
      upgradeLevel: 0, 
      upgradeCost: 12000, 
      cost: 15000,
      visible: false
    },
    spaceStationModule: {
      name: "Module station spatiale",
      baseCost: 40000,
      quantity: 0,
      distBoost: 2500,
      upgradeLevel: 0,
      upgradeCost: 35000,
      cost: 40000,
      visible: false
    },
  };

  // Powerups state
  let powerups = {
    doubleClick: { active: false, timeoutId: null, cost: 500 },
    doubleAuto: { active: false, timeoutId: null, cost: 800 },
  };

  // Launch state
  let launchInProgress = false;

  // DOM Elements
  const moneyEl = document.getElementById("money");
  const distPerClickEl = document.getElementById("distPerClick");
  const distPerSecEl = document.getElementById("distPerSec");
  const distanceMaxEl = document.getElementById("distanceMax");
  const distanceLeftEl = document.getElementById("distanceLeft");
  const itemsContainer = document.getElementById("itemsContainer");
  const launchBtn = document.getElementById("launchBtn");
  const launchProgressBar = document.getElementById("launchProgress");
  const launchText = document.getElementById("launchText");
  const powerupDoubleClickBtn = document.getElementById("doubleClick");
  const powerupDoubleAutoBtn = document.getElementById("doubleAuto");
  const powerupStatusEl = document.getElementById("powerupStatus");

  // --- Fonctions de mise √† jour ---
  function updateDisplay() {
    moneyEl.textContent = Math.floor(money);
    distPerClickEl.textContent = distPerClick.toFixed(1);
    distPerSecEl.textContent = distPerSec.toFixed(1);
    distanceMaxEl.textContent = distanceMax.toFixed(0);
    let distLeft = Math.max(TARGET_DISTANCE - distanceMax, 0);
    distanceLeftEl.textContent = distLeft.toFixed(0);

    // Activer ou d√©sactiver le bouton lancement selon argent et distance max
    launchBtn.disabled = money < LAUNCH_COST || distanceMax <= 0 || launchInProgress;

    // Activer/d√©sactiver powerups selon argent
    powerupDoubleClickBtn.disabled = money < powerups.doubleClick.cost || powerups.doubleClick.active;
    powerupDoubleAutoBtn.disabled = money < powerups.doubleAuto.cost || powerups.doubleAuto.active;

    // Met √† jour visibilit√© items selon argent
    for(let key in items){
      if(money >= items[key].baseCost){
        items[key].visible = true;
      } else if(items[key].quantity === 0){
        items[key].visible = false;
      }
    }
    renderItems();

    saveGame();
  }

  // Sauvegarde dans localStorage
  function saveGame(){
    localStorage.setItem("money", money);
    localStorage.setItem("distPerClick", distPerClick);
    localStorage.setItem("distPerSec", distPerSec);
    localStorage.setItem("distanceMax", distanceMax);

    for(let key in items){
      localStorage.setItem(key+"_quantity", items[key].quantity);
      localStorage.setItem(key+"_upgrade", items[key].upgradeLevel);
      localStorage.setItem(key+"_cost", items[key].cost);
      localStorage.setItem(key+"_upgradeCost", items[key].upgradeCost);
      localStorage.setItem(key+"_visible", items[key].visible);
    }
  }

  // Chargement sauvegarde
  function loadGame(){
    money = parseFloat(localStorage.getItem("money")) || 0;
    distPerClick = parseFloat(localStorage.getItem("distPerClick")) || 1;
    distPerSec = parseFloat(localStorage.getItem("distPerSec")) || 0;
    distanceMax = parseFloat(localStorage.getItem("distanceMax")) || 0;

    for(let key in items){
      items[key].quantity = parseInt(localStorage.getItem(key+"_quantity")) || 0;
      items[key].upgradeLevel = parseInt(localStorage.getItem(key+"_upgrade")) || 0;
      items[key].cost = parseFloat(localStorage.getItem(key+"_cost")) || items[key].baseCost;
      items[key].upgradeCost = parseFloat(localStorage.getItem(key+"_upgradeCost")) || items[key].upgradeCost;
      items[key].visible = (localStorage.getItem(key+"_visible") === "true") || false;
    }
  }

  // Calculer la distance max en fonction des items et upgrades
  function calcDistanceMax(){
    let dist = 0;
    for(let key in items){
      let base = items[key].distBoost;
      let lvl = items[key].upgradeLevel;
      // chaque upgrade augmente la puissance par 50% par niveau
      let powerMultiplier = 1 + 0.5 * lvl;
      dist += items[key].quantity * base * powerMultiplier;
    }
    distanceMax = dist;
    distPerClick = 1; // de base
    distPerSec = 0;

    // Dist par clic = base 1 + 20% de la distanceMax (environ)
    distPerClick += distanceMax * 0.2;

    // Dist par seconde = 10% de distanceMax
    distPerSec += distanceMax * 0.1;

    // Si powerup actif, doubler distPerClick ou distPerSec
    if(powerups.doubleClick.active) distPerClick *= 2;
    if(powerups.doubleAuto.active) distPerSec *= 2;
  }

  // Fonction d‚Äôachat d‚Äôitems
  function buyItem(key){
    let item = items[key];
    if(money >= item.cost){
      money -= item.cost;
      item.quantity++;
      // le co√ªt augmente de 20% √† chaque achat
      item.cost = Math.floor(item.cost * 1.2);
      calcDistanceMax();
      updateDisplay();
    } else {
      alert("Pas assez d'argent pour acheter "+item.name);
    }
  }

  // Fonction am√©lioration items
  function upgradeItem(key){
    let item = items[key];
    if(money >= item.upgradeCost){
      money -= item.upgradeCost;
      item.upgradeLevel++;
      // Le co√ªt d‚Äôupgrade augmente plus vite (x2)
      item.upgradeCost = Math.floor(item.upgradeCost * 2);
      calcDistanceMax();
      updateDisplay();
    } else {
      alert("Pas assez d'argent pour am√©liorer "+item.name);
    }
  }

  // Affichage des items
  function renderItems(){
    itemsContainer.innerHTML = "";
    for(let key in items){
      let item = items[key];
      if(!item.visible && item.quantity === 0) continue;

      let div = document.createElement("div");
      div.className = "item-card";

      div.innerHTML = `
        <div class="item-info">
          <span>${item.name}</span>
          <div class="item-stats">
            Quantit√©: ${item.quantity} | Distance unitaire: ${item.distBoost} km<br/>
            Niveau d'am√©lioration: ${item.upgradeLevel} (x${(1 + 0.5 * item.upgradeLevel).toFixed(2)})<br/>
            Prix achat: ${item.cost} ‚Ç¨ | Prix am√©lioration: ${item.upgradeCost} ‚Ç¨
          </div>
        </div>
        <div class="item-controls">
          <button ${money < item.cost ? "disabled" : ""} onclick="buyItem('${key}')">Acheter</button>
          <button class="upgrade-btn" ${money < item.upgradeCost ? "disabled" : ""} onclick="upgradeItem('${key}')">Am√©liorer</button>
        </div>
      `;
      itemsContainer.appendChild(div);
    }
  }

  // Gestion clic manuel
  document.body.addEventListener("click", () => {
    if(launchInProgress) return; // pas de clic pendant lancement

    money += distPerClick;
    updateDisplay();
  });

  // Ajout distance auto chaque seconde
  setInterval(() => {
    if(launchInProgress) return;
    money += distPerSec;
    updateDisplay();
  }, 1000);

  // Powerups
  function activatePowerup(type){
    if(money < powerups[type].cost) return alert("Pas assez d'argent");
    if(powerups[type].active) return alert("Powerup d√©j√† actif");

    money -= powerups[type].cost;
    powerups[type].active = true;
    updateDisplay();
    powerupStatusEl.textContent = `${type === "doubleClick" ? "Double distance clic" : "Double distance auto"} activ√© pour 30 secondes !`;

    powerups[type].timeoutId = setTimeout(() => {
      powerups[type].active = false;
      powerupStatusEl.textContent = "";
      calcDistanceMax();
      updateDisplay();
    }, POWERUP_DURATION);

    calcDistanceMax();
    updateDisplay();
  }

  powerupDoubleClickBtn.addEventListener("click", () => activatePowerup("doubleClick"));
  powerupDoubleAutoBtn.addEventListener("click", () => activatePowerup("doubleAuto"));

  // Lancement de la fus√©e
  launchBtn.addEventListener("click", () => {
    if(launchInProgress) return;
    if(money < LAUNCH_COST){
      alert("Pas assez d'argent pour lancer la fus√©e !");
      return;
    }
    if(distanceMax <= 0){
      alert("Tu dois construire ta fus√©e pour la lancer !");
      return;
    }

    money -= LAUNCH_COST;
    updateDisplay();
    launchInProgress = true;
    launchText.textContent = "Lancement en cours...";
    launchProgressBar.style.width = "0%";

    let progress = 0;
    const progressSpeed = 1; // % par intervalle (peut changer pour ralentir progression)
    const intervalTime = 100; // ms

    let launchInterval = setInterval(() => {
      progress += progressSpeed;
      if(progress > 100) progress = 100;
      launchProgressBar.style.width = progress + "%";

      if(progress >= 100){
        clearInterval(launchInterval);
        launchInProgress = false;

        // Calcul r√©sultat du lancement, distance atteinte = distanceMax * facteur al√©atoire (80% - 100%)
        let facteur = 0.8 + Math.random() * 0.2;
        let distanceAtteinte = Math.floor(distanceMax * facteur);
        launchText.textContent = `Fus√©e a atteint ${distanceAtteinte} km !`;

        // R√©compense en argent en fonction de la distance atteinte (1‚Ç¨ = 1km)
        money += distanceAtteinte;
        updateDisplay();

        // Si atteint la cible, message de victoire
        if(distanceAtteinte >= TARGET_DISTANCE){
          alert("üéâ F√©licitations ! Ta fus√©e a atteint l'espace ! Tu as gagn√© !");
          resetGame();
        }
      }
    }, intervalTime);
  });

  // Reset complet (optionnel)
  function resetGame(){
    money = 0;
    distPerClick = 1;
    distPerSec = 0;
    distanceMax = 0;
    for(let key in items){
      items[key].quantity = 0;
      items[key].upgradeLevel = 0;
      items[key].cost = items[key].baseCost;
      items[key].upgradeCost = items[key].upgradeCost;
      items[key].visible = false;
    }
    powerups.doubleClick.active = false;
    powerups.doubleAuto.active = false;
    powerupStatusEl.textContent = "";
    updateDisplay();
  }

  // Expose fonctions pour boutons inline
  window.buyItem = buyItem;
  window.upgradeItem = upgradeItem;

  // Initialisation
  loadGame();
  calcDistanceMax();
  updateDisplay();

</script>

</body>
</html>
